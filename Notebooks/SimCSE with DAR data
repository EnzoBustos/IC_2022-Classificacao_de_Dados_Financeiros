{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"name":"SimCSE with DAR data","provenance":[],"collapsed_sections":[],"authorship_tag":"ABX9TyNgiyWlzMSi0VUj0pJ/3p8k"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"92db3596e37d40098d9f11db87146101":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_6740b826411542788bac4c9e7d5b8b0c","IPY_MODEL_569e6b3c354146778a39b9048c584276","IPY_MODEL_4976443d9fb74fa296b9c31b18892879"],"layout":"IPY_MODEL_4923f382a8ec46199a21c229de94a1e2"}},"6740b826411542788bac4c9e7d5b8b0c":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_90f424631ac84330b06e7572b3dbf559","placeholder":"​","style":"IPY_MODEL_9c8b25a1c0fb4412a89d001c57bb6631","value":"Epoch: 100%"}},"569e6b3c354146778a39b9048c584276":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_13272d9efd8f4dfca526dca4d1a44009","max":1,"min":0,"orientation":"horizontal","style":"IPY_MODEL_7ab5ca00037d41e6a14232e5b5c13103","value":1}},"4976443d9fb74fa296b9c31b18892879":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_7cad0ec2c6b24bb7bad505eb1d99d052","placeholder":"​","style":"IPY_MODEL_d72a0764b698439ab7fbe5fd21e0cd80","value":" 1/1 [05:59&lt;00:00, 359.24s/it]"}},"4923f382a8ec46199a21c229de94a1e2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"90f424631ac84330b06e7572b3dbf559":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9c8b25a1c0fb4412a89d001c57bb6631":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"13272d9efd8f4dfca526dca4d1a44009":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"7ab5ca00037d41e6a14232e5b5c13103":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"7cad0ec2c6b24bb7bad505eb1d99d052":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d72a0764b698439ab7fbe5fd21e0cd80":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"469d48bb2a4345e9b972cd22f2ef706a":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_5152fac1fb5c4f018095ae53f1f11eb0","IPY_MODEL_f760084e6aaf4efe89f49e67935e9b6c","IPY_MODEL_29a582eaedbd4c21824242c04acef038"],"layout":"IPY_MODEL_f62e13033ca14933bd698d3dd47350af"}},"5152fac1fb5c4f018095ae53f1f11eb0":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_87ca21fc323140e2ab87891355d2015e","placeholder":"​","style":"IPY_MODEL_0c3f561b27cc4c3aa02963603152317e","value":"Iteration: 100%"}},"f760084e6aaf4efe89f49e67935e9b6c":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_f9c026cb0c2d415092d10275d12b9280","max":20,"min":0,"orientation":"horizontal","style":"IPY_MODEL_949056c35f884f12b7d8ba22d5ede106","value":20}},"29a582eaedbd4c21824242c04acef038":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_b19ce00812374aa59eca4a9e5532dda7","placeholder":"​","style":"IPY_MODEL_780fb20c192c43e3b4b06ab06b04039c","value":" 20/20 [05:59&lt;00:00, 17.30s/it]"}},"f62e13033ca14933bd698d3dd47350af":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"87ca21fc323140e2ab87891355d2015e":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"0c3f561b27cc4c3aa02963603152317e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"f9c026cb0c2d415092d10275d12b9280":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"949056c35f884f12b7d8ba22d5ede106":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"b19ce00812374aa59eca4a9e5532dda7":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"780fb20c192c43e3b4b06ab06b04039c":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"cells":[{"cell_type":"code","source":["!pip install sentence_transformers"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"ykzqUCKfHen_","executionInfo":{"status":"ok","timestamp":1651672013527,"user_tz":180,"elapsed":5134,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}},"outputId":"0b18c11f-144e-47b4-e2a8-d8f1b3eb9aa2"},"execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: sentence_transformers in /usr/local/lib/python3.7/dist-packages (2.2.0)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from sentence_transformers) (1.21.6)\n","Requirement already satisfied: nltk in /usr/local/lib/python3.7/dist-packages (from sentence_transformers) (3.2.5)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from sentence_transformers) (1.0.2)\n","Requirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from sentence_transformers) (1.4.1)\n","Requirement already satisfied: torch>=1.6.0 in /usr/local/lib/python3.7/dist-packages (from sentence_transformers) (1.11.0+cu113)\n","Requirement already satisfied: tqdm in /usr/local/lib/python3.7/dist-packages (from sentence_transformers) (4.64.0)\n","Requirement already satisfied: huggingface-hub in /usr/local/lib/python3.7/dist-packages (from sentence_transformers) (0.5.1)\n","Requirement already satisfied: transformers<5.0.0,>=4.6.0 in /usr/local/lib/python3.7/dist-packages (from sentence_transformers) (4.18.0)\n","Requirement already satisfied: sentencepiece in /usr/local/lib/python3.7/dist-packages (from sentence_transformers) (0.1.96)\n","Requirement already satisfied: torchvision in /usr/local/lib/python3.7/dist-packages (from sentence_transformers) (0.12.0+cu113)\n","Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from torch>=1.6.0->sentence_transformers) (4.2.0)\n","Requirement already satisfied: sacremoses in /usr/local/lib/python3.7/dist-packages (from transformers<5.0.0,>=4.6.0->sentence_transformers) (0.0.53)\n","Requirement already satisfied: regex!=2019.12.17 in /usr/local/lib/python3.7/dist-packages (from transformers<5.0.0,>=4.6.0->sentence_transformers) (2019.12.20)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.7/dist-packages (from transformers<5.0.0,>=4.6.0->sentence_transformers) (3.6.0)\n","Requirement already satisfied: pyyaml>=5.1 in /usr/local/lib/python3.7/dist-packages (from transformers<5.0.0,>=4.6.0->sentence_transformers) (6.0)\n","Requirement already satisfied: tokenizers!=0.11.3,<0.13,>=0.11.1 in /usr/local/lib/python3.7/dist-packages (from transformers<5.0.0,>=4.6.0->sentence_transformers) (0.12.1)\n","Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from transformers<5.0.0,>=4.6.0->sentence_transformers) (2.23.0)\n","Requirement already satisfied: importlib-metadata in /usr/local/lib/python3.7/dist-packages (from transformers<5.0.0,>=4.6.0->sentence_transformers) (4.11.3)\n","Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.7/dist-packages (from transformers<5.0.0,>=4.6.0->sentence_transformers) (21.3)\n","Requirement already satisfied: pyparsing!=3.0.5,>=2.0.2 in /usr/local/lib/python3.7/dist-packages (from packaging>=20.0->transformers<5.0.0,>=4.6.0->sentence_transformers) (3.0.8)\n","Requirement already satisfied: zipp>=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata->transformers<5.0.0,>=4.6.0->sentence_transformers) (3.8.0)\n","Requirement already satisfied: six in /usr/local/lib/python3.7/dist-packages (from nltk->sentence_transformers) (1.15.0)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->transformers<5.0.0,>=4.6.0->sentence_transformers) (2021.10.8)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->transformers<5.0.0,>=4.6.0->sentence_transformers) (2.10)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->transformers<5.0.0,>=4.6.0->sentence_transformers) (1.24.3)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->transformers<5.0.0,>=4.6.0->sentence_transformers) (3.0.4)\n","Requirement already satisfied: joblib in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers<5.0.0,>=4.6.0->sentence_transformers) (1.1.0)\n","Requirement already satisfied: click in /usr/local/lib/python3.7/dist-packages (from sacremoses->transformers<5.0.0,>=4.6.0->sentence_transformers) (7.1.2)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->sentence_transformers) (3.1.0)\n","Requirement already satisfied: pillow!=8.3.*,>=5.3.0 in /usr/local/lib/python3.7/dist-packages (from torchvision->sentence_transformers) (7.1.2)\n"]}]},{"cell_type":"code","source":["from sentence_transformers import SentenceTransformer, InputExample\n","from sentence_transformers import models, losses\n","from torch.utils.data import DataLoader"],"metadata":{"id":"R9qOMWAFHGix","executionInfo":{"status":"ok","timestamp":1651672026438,"user_tz":180,"elapsed":12915,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}}},"execution_count":2,"outputs":[]},{"cell_type":"code","source":["# Define your sentence transformer model using CLS pooling\n","model_name = 'neuralmind/bert-base-portuguese-cased'\n","word_embedding_model = models.Transformer(model_name, max_seq_length=256)\n","pooling_model = models.Pooling(word_embedding_model.get_word_embedding_dimension())\n","model = SentenceTransformer(modules=[word_embedding_model, pooling_model])"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Og3m-OO3HIck","executionInfo":{"status":"ok","timestamp":1651672032978,"user_tz":180,"elapsed":6543,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}},"outputId":"a196361a-0590-4a79-9f2f-e12e505636b9"},"execution_count":3,"outputs":[{"output_type":"stream","name":"stderr","text":["Some weights of the model checkpoint at neuralmind/bert-base-portuguese-cased were not used when initializing BertModel: ['cls.predictions.transform.LayerNorm.bias', 'cls.seq_relationship.weight', 'cls.predictions.transform.dense.bias', 'cls.predictions.decoder.weight', 'cls.seq_relationship.bias', 'cls.predictions.transform.LayerNorm.weight', 'cls.predictions.bias', 'cls.predictions.transform.dense.weight']\n","- This IS expected if you are initializing BertModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).\n","- This IS NOT expected if you are initializing BertModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).\n"]}]},{"cell_type":"code","source":["import pandas as pd\n","\n","df = pd.read_excel(\"Dados DAR.xlsx\")\n","df.drop([\"Unnamed: 0\"], axis=1, inplace=True)\n","df.head()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":354},"id":"S8qKXbF-Hway","executionInfo":{"status":"ok","timestamp":1651672039404,"user_tz":180,"elapsed":6430,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}},"outputId":"c5a09be5-6977-4d36-da7b-e9f291ea38eb"},"execution_count":4,"outputs":[{"output_type":"execute_result","data":{"text/plain":["  Transcript                    Date  Position      Person  \\\n","0    DAR-001  17 DE SETEMBRO DE 2020       0.0  Presidente   \n","1    DAR-001  17 DE SETEMBRO DE 2020       1.0  Secretária   \n","2    DAR-001  17 DE SETEMBRO DE 2020       2.0  Presidente   \n","3    DAR-001  17 DE SETEMBRO DE 2020       3.0  Secretária   \n","4    DAR-001  17 DE SETEMBRO DE 2020       4.0  Presidente   \n","\n","                  Party                                               Text  \\\n","0                   NaN  Dirijo um abraço a todos neste regresso dos Pl...   \n","1  Maria da Luz Rosinha  Sr. Presidente, muito boa tarde a todas e a to...   \n","2                   NaN  Como os Srs. Deputados estão a verificar, o an...   \n","3  Maria da Luz Rosinha  Sr. Presidente, deram também entrada os Projet...   \n","4                   NaN  Muito obrigado, Sr.ª Secretária Maria da Luz R...   \n","\n","             Initiatives  Text Length  \n","0  declarações políticas        563.0  \n","1  declarações políticas        460.0  \n","2  declarações políticas        232.0  \n","3  declarações políticas        694.0  \n","4  declarações políticas        470.0  "],"text/html":["\n","  <div id=\"df-2c62e028-7ec2-4122-8a33-25e990be8ed5\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>Transcript</th>\n","      <th>Date</th>\n","      <th>Position</th>\n","      <th>Person</th>\n","      <th>Party</th>\n","      <th>Text</th>\n","      <th>Initiatives</th>\n","      <th>Text Length</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>DAR-001</td>\n","      <td>17 DE SETEMBRO DE 2020</td>\n","      <td>0.0</td>\n","      <td>Presidente</td>\n","      <td>NaN</td>\n","      <td>Dirijo um abraço a todos neste regresso dos Pl...</td>\n","      <td>declarações políticas</td>\n","      <td>563.0</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>DAR-001</td>\n","      <td>17 DE SETEMBRO DE 2020</td>\n","      <td>1.0</td>\n","      <td>Secretária</td>\n","      <td>Maria da Luz Rosinha</td>\n","      <td>Sr. Presidente, muito boa tarde a todas e a to...</td>\n","      <td>declarações políticas</td>\n","      <td>460.0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>DAR-001</td>\n","      <td>17 DE SETEMBRO DE 2020</td>\n","      <td>2.0</td>\n","      <td>Presidente</td>\n","      <td>NaN</td>\n","      <td>Como os Srs. Deputados estão a verificar, o an...</td>\n","      <td>declarações políticas</td>\n","      <td>232.0</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>DAR-001</td>\n","      <td>17 DE SETEMBRO DE 2020</td>\n","      <td>3.0</td>\n","      <td>Secretária</td>\n","      <td>Maria da Luz Rosinha</td>\n","      <td>Sr. Presidente, deram também entrada os Projet...</td>\n","      <td>declarações políticas</td>\n","      <td>694.0</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>DAR-001</td>\n","      <td>17 DE SETEMBRO DE 2020</td>\n","      <td>4.0</td>\n","      <td>Presidente</td>\n","      <td>NaN</td>\n","      <td>Muito obrigado, Sr.ª Secretária Maria da Luz R...</td>\n","      <td>declarações políticas</td>\n","      <td>470.0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-2c62e028-7ec2-4122-8a33-25e990be8ed5')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-2c62e028-7ec2-4122-8a33-25e990be8ed5 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-2c62e028-7ec2-4122-8a33-25e990be8ed5');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":4}]},{"cell_type":"code","source":["# Define a list with sentences (1k - 100k sentences)\n","train_sentences = [text for text in df[\"Text\"][:100]]"],"metadata":{"id":"a9rEnH6iIO6W","executionInfo":{"status":"ok","timestamp":1651672039405,"user_tz":180,"elapsed":6,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}}},"execution_count":5,"outputs":[]},{"cell_type":"code","source":["print(train_sentences[0])\n","print()\n","print(train_sentences[1])\n","print()\n","print(train_sentences[2])\n","print()\n","print(\"\\n\\nTamanho dos dados\")\n","print(len(train_sentences))"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"H6tT1NQJIUIG","executionInfo":{"status":"ok","timestamp":1651672039405,"user_tz":180,"elapsed":5,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}},"outputId":"1f2eaec0-c5f7-4f00-ee41-502e37a2062a"},"execution_count":6,"outputs":[{"output_type":"stream","name":"stdout","text":["Dirijo um abraço a todos neste regresso dos Plenários à Casa da democracia. Esperávamos que nesta altura já pudéssemos ter regras mais flexíveis, mas, infelizmente, os números e as consequências concretas não nos permitem tal, e, portanto, continuamos, no essencial, com as regras que presidiram aos últimos Plenários da 1.ª Sessão Legislativa. Srs. Deputados, da nossa ordem do dia constam declarações políticas. Porém, antes disso, a Sr.ª Secretária Maria da Luz Rosinha fará o favor de anunciar a entrada de algumas iniciativas. Tem a palavra, Sr.ª Secretária.\n","\n","Sr. Presidente, muito boa tarde a todas e a todos. Deram entrada na Mesa, e foram admitidos, os Projetos de Lei n.os 485/XIV/1.ª (BE), 486/XIV/1.ª (PCP), 487/XIV/1.ª (PAN), 488/XIV/1.ª (PCP), 489/XIV/1.ª (CDS-PP), 490/XIV/1.ª (CDS-PP), 491/XIV/1.ª (PAN), 492/XIV/1.ª (PCP), 493/XIV/1.ª (PAN), 494/XIV/1.ª (Deputada não inscrita Cristina Rodrigues), 495/XIV/1.ª (BE), 496/XIV/1.ª (Deputada não inscrita Cristina Rodrigues), 497/XIV/1.ª (PAN), 498/XIV/1.ª (PAN)…\n","\n","Como os Srs. Deputados estão a verificar, o anúncio do expediente já segue as regras do novo Regimento, aprovado por VV. Ex.as numa das últimas reuniões plenárias da 1.ª Sessão Legislativa. Faça favor de prosseguir, Sr.ª Secretária.\n","\n","\n","\n","Tamanho dos dados\n","100\n"]}]},{"cell_type":"code","source":["# Convert train sentences to sentence pairs\n","train_data = [InputExample(texts=[s, s]) for s in train_sentences]"],"metadata":{"id":"40W6UU3JHNUB","executionInfo":{"status":"ok","timestamp":1651672039406,"user_tz":180,"elapsed":5,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}}},"execution_count":7,"outputs":[]},{"cell_type":"code","source":["# DataLoader to batch your data\n","train_dataloader = DataLoader(train_data, batch_size=5, shuffle=True)"],"metadata":{"id":"AVuP9a_XHNWv","executionInfo":{"status":"ok","timestamp":1651672039406,"user_tz":180,"elapsed":5,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}}},"execution_count":8,"outputs":[]},{"cell_type":"code","source":["# Use the denoising auto-encoder loss\n","train_loss = losses.MultipleNegativesRankingLoss(model)"],"metadata":{"id":"5Hh5Ow-ZHNbS","executionInfo":{"status":"ok","timestamp":1651672039406,"user_tz":180,"elapsed":5,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}}},"execution_count":9,"outputs":[]},{"cell_type":"code","source":["import gc\n","import torch\n","\n","gc.collect()\n","torch.cuda.empty_cache()"],"metadata":{"id":"K8K68TnsKIbm","executionInfo":{"status":"ok","timestamp":1651672039871,"user_tz":180,"elapsed":7,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}}},"execution_count":10,"outputs":[]},{"cell_type":"code","source":["# Call the fit method\n","model.fit(\n","    train_objectives=[(train_dataloader, train_loss)],\n","    epochs=1,\n","    show_progress_bar=True\n",")"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":136,"referenced_widgets":["92db3596e37d40098d9f11db87146101","6740b826411542788bac4c9e7d5b8b0c","569e6b3c354146778a39b9048c584276","4976443d9fb74fa296b9c31b18892879","4923f382a8ec46199a21c229de94a1e2","90f424631ac84330b06e7572b3dbf559","9c8b25a1c0fb4412a89d001c57bb6631","13272d9efd8f4dfca526dca4d1a44009","7ab5ca00037d41e6a14232e5b5c13103","7cad0ec2c6b24bb7bad505eb1d99d052","d72a0764b698439ab7fbe5fd21e0cd80","469d48bb2a4345e9b972cd22f2ef706a","5152fac1fb5c4f018095ae53f1f11eb0","f760084e6aaf4efe89f49e67935e9b6c","29a582eaedbd4c21824242c04acef038","f62e13033ca14933bd698d3dd47350af","87ca21fc323140e2ab87891355d2015e","0c3f561b27cc4c3aa02963603152317e","f9c026cb0c2d415092d10275d12b9280","949056c35f884f12b7d8ba22d5ede106","b19ce00812374aa59eca4a9e5532dda7","780fb20c192c43e3b4b06ab06b04039c"]},"id":"Ak7mPSvMHNgj","outputId":"119f31a8-e73d-4f11-f3ae-0710a436d0ed","executionInfo":{"status":"ok","timestamp":1651672398918,"user_tz":180,"elapsed":359053,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}}},"execution_count":11,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/transformers/optimization.py:309: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning\n","  FutureWarning,\n"]},{"output_type":"display_data","data":{"text/plain":["Epoch:   0%|          | 0/1 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"92db3596e37d40098d9f11db87146101"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["Iteration:   0%|          | 0/20 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"469d48bb2a4345e9b972cd22f2ef706a"}},"metadata":{}}]},{"cell_type":"code","source":["model.save('output/simcse-model-DAR_DATA')"],"metadata":{"id":"QrU7H_Z9HSU2","executionInfo":{"status":"ok","timestamp":1651672400112,"user_tz":180,"elapsed":1206,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}}},"execution_count":12,"outputs":[]},{"cell_type":"code","source":[""],"metadata":{"id":"TND2f0jkK2dY","executionInfo":{"status":"ok","timestamp":1651672400113,"user_tz":180,"elapsed":4,"user":{"displayName":"Enzo Bustos da Silva","userId":"00423683093258305256"}}},"execution_count":12,"outputs":[]}]}